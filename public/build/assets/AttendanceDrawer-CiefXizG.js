import{r as m,W as I,j as i}from"./app-DK9Td1gN.js";import{D as p,a as F,b as w,B as O}from"./ToggleSwitch-BEsFegO1.js";import{I as c}from"./InputError-BpmO9yAk.js";import{C as A}from"./CustomDatepicker-CxbDm65z.js";function z({isOpen:v,onClose:_,attendance:a=null,employees:u,clients:o,shiftTypes:b}){var j;const t=a!==null,[l,x]=m.useState(null);m.useState(new Date);const{data:s,setData:d,errors:r,post:f,put:g,processing:y,reset:S}=I({date:"",employee_id:"",client_id:"",city_id:"",shift_type_id:"",task_id:""});m.useEffect(()=>{a&&t&&(d({date:a.date||"",employee_id:a.employee.id||"",client_id:a.client.id||"",city_id:a.city.id||"",shift_type_id:a.shiftType.id||"",task_id:a.task.id||""}),x(o.data.find(e=>e.id===a.client.id)))},[a,o]);const N=e=>{e.preventDefault();const n=t?g:f,h=t?route("attendances.update",a.id):route("attendances.store");n(h,{onSuccess:()=>{_(),S()},onError:D=>{console.error("Error handling attendance: ",D)}})},k=e=>{const n=o.data.find(h=>h.id===parseInt(e.target.value,10));x(n),d({...s,city_id:"",client_id:e.target.value})},E=()=>{const e=u.data.find(n=>n.id===parseInt(s.employee_id,10));return(e==null?void 0:e.contract_type)==="OBL"},C=()=>{const e=u.data.find(n=>n.id===parseInt(s.employee_id,10));return(e==null?void 0:e.contract_type)==="IND"};return i.jsxs(p,{open:v,onClose:_,position:"right",children:[i.jsx(p.Header,{title:t?"Editar asistencia":"Agregar asistencia",titleIcon:t?F:w}),i.jsx(p.Items,{children:i.jsxs("form",{onSubmit:N,children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"date",className:"label",children:"Fecha"}),i.jsx(A,{value:s.date,onChange:e=>d("date",e),disabled:t,id:"date"}),i.jsx(c,{message:r.date})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"employee_id",className:"label",children:"Empleado"}),i.jsxs("select",{id:"employee_id",value:s.employee_id,onChange:e=>d("employee_id",e.target.value),className:"input",children:[i.jsx("option",{value:"",disabled:!0,children:"Selecciona el usuario..."}),u.data.map(e=>i.jsx("option",{value:e.id,children:e.first_name+" "+e.last_name},e.id))]}),i.jsx(c,{message:r.employee_id})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"client_id",className:"label",children:"Operación"}),i.jsxs("select",{id:"client_id",value:s.client_id,onChange:k,className:"input",children:[i.jsx("option",{value:"",disabled:!0,children:"Selecciona el cliente..."}),o.data.map(e=>i.jsx("option",{value:e.id,children:e.company_name},e.id))]}),i.jsx(c,{message:r.client_id})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"city_id",className:"label",children:"Ciudad de la Operación"}),i.jsxs("select",{id:"city_id",value:s.city_id,onChange:e=>d("city_id",e.target.value),disabled:!l,className:"input",children:[i.jsx("option",{value:"",disabled:!0,children:"Selecciona la ciudad..."}),l==null?void 0:l.cities.map(e=>i.jsx("option",{value:e.id,children:e.city_name},e.id))]}),i.jsx(c,{message:r.city_id})]}),C()&&i.jsxs("div",{children:[i.jsx("label",{htmlFor:"shift_type_id",className:"label",children:"Tipo de turno"}),i.jsxs("select",{id:"shift_type_id",value:s.shift_type_id,onChange:e=>d("shift_type_id",e.target.value),className:"input",children:[i.jsx("option",{value:"",disabled:!0,children:"Selecciona el tipo de turno..."}),b.data.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]}),i.jsx(c,{message:r.shift_type_id})]}),E()&&i.jsxs("div",{children:[i.jsx("label",{htmlFor:"task_id",className:"label",children:"Tipo de tarea"}),i.jsxs("select",{id:"task_id",value:s.task_id,onChange:e=>d("task_id",e.target.value),className:"input",children:[i.jsx("option",{value:"",disabled:!0,children:"Selecciona el tipo de tarea..."}),(j=l==null?void 0:l.tasks)==null?void 0:j.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]}),i.jsx(c,{message:r.task_id})]})]}),i.jsx(O,{type:"submit",disabled:y,color:"blue",className:"mt-4 w-full text-base font-medium",children:t?"Actualizar asistencia":"Guardar asistencia"})]})})]})}export{z as default};
